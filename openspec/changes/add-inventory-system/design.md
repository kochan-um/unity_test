## Context
オープンワールド＋マルチプレイヤー対応のUnityプロジェクトにインベントリシステムを追加する。
アイテムカテゴリはゲームデザインに応じて柔軟に定義できる必要がある。
UIはドラッグ&ドロップを含むフル操作に対応し、Supabaseでクラウド保存する。
マルチプレイヤー同期は現時点ではスコープ外だが、将来的なPhoton連携を考慮した設計にする。

## Goals / Non-Goals
- Goals:
  - ScriptableObjectでアイテムをデータ駆動に定義できる
  - カテゴリをエディタ上で自由に追加・管理できる
  - スタック・ドラッグ&ドロップ・ソート・フィルタリングを備えたUIを提供する
  - Supabase経由でインベントリデータを永続化できる
  - ワールド上のアイテムを拾う・捨てる操作ができる
- Non-Goals:
  - マルチプレイヤー同期（Photon連携は将来対応）
  - クラフトシステム（別提案で対応）
  - トレード・交換機能（別提案で対応）
  - 装備スロット・装備による能力値変化（別提案で対応）

## Decisions

### アイテム定義: ScriptableObject + ItemCategoryアセット
- **決定**: アイテムはScriptableObject (`ItemDefinition`) で定義し、カテゴリもScriptableObject (`ItemCategory`) として独立管理する
- **理由**: Enumだとコード変更が必要になるが、ScriptableObjectならエディタ上でデザイナーが自由にカテゴリを追加できる
- **代替案**: Enum定義 → 拡張時にリコンパイルが必要、string定義 → 型安全性がない

### インベントリデータ構造: スロットベース配列
- **決定**: 固定サイズのスロット配列で管理する。各スロットは `ItemDefinition` への参照と数量を持つ
- **理由**: UIのグリッド表示と直感的に対応し、ドラッグ&ドロップのスロット間移動が自然に実装できる
- **代替案**: Dictionary方式 → UIのスロット位置管理が複雑になる

### UI: Unity UI (uGUI) + EventSystem
- **決定**: uGUIのIBeginDragHandler/IDragHandler/IEndDragHandlerインターフェースでD&Dを実装する
- **理由**: 既存のUnity EventSystemと統合しやすく、追加パッケージ不要
- **代替案**: UI Toolkit → ランタイムUIのD&D実装がまだ不安定

### 永続化: Repository パターン
- **決定**: `IInventoryRepository` インターフェースを定義し、Supabase実装 (`SupabaseInventoryRepository`) を提供する
- **理由**: Supabase依存を分離でき、テスト時やオフライン時にローカル実装に差し替え可能
- **代替案**: 直接Supabaseクライアントを呼ぶ → テスト困難、将来のバックエンド変更時に修正箇所が多い

### ネットワーク将来対応: イベント駆動設計
- **決定**: インベントリ操作（追加・削除・移動等）をイベント（C# event / UnityEvent）で通知する設計にする
- **理由**: 将来Photon連携する際、イベントリスナーとしてネットワーク同期ロジックを差し込めるため、既存コードの改変が最小限で済む

## Risks / Trade-offs
- ScriptableObjectベースのカテゴリは柔軟だが、カテゴリの一意性管理はID文字列に依存する → IDの命名規則をドキュメント化して対応
- スロット配列は固定サイズのため、動的なサイズ変更が必要な場合は拡張が必要 → 初期実装ではScriptableObjectの設定値で最大スロット数を定義
- Supabase永続化はネットワーク依存のため、オフライン時の挙動を考慮する必要がある → ローカルキャッシュとリトライ機構で対応

## Open Questions
- アイテムの最大スタック数はアイテムごとに個別設定か、カテゴリごとの設定か？（初期案: アイテムごとに `maxStackSize` を定義）
- インベントリの最大スロット数のデフォルト値は？（初期案: 30スロット）
